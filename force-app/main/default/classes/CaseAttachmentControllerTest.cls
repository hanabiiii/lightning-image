@isTest
public class CaseAttachmentControllerTest {

    @IsTest
    public static void testCaseAttachmnent() {
        Case testCase = new Case(Subject='Test Case', Priority='Low', Status='New');
        insert testCase;
        
        String image = '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';
        String fileName = 'testImage.jpg';
        
        ContentVersion cv = new ContentVersion();
        cv.Title = fileName;
        cv.PathOnClient = fileName;
        cv.ContentLocation = 'S';
        cv.IsMajorVersion = false;
        cv.VersionData = EncodingUtil.base64Decode(image);
        insert cv;
        
        String insertedCvId = cv.Id;
        List<ContentVersion> insertedCvs = Database.query('SELECT Id, ContentDocumentId, Title, OwnerId FROM ContentVersion WHERE Id = :insertedCvId');
        
        List<ContentDocumentLink> cdLinks = new List<ContentDocumentLink>();
        for(ContentVersion insertedCv : insertedCvs) {
            ContentDocumentLink cdl = new ContentDocumentLink();
            cdl.ContentDocumentId = insertedCv.ContentDocumentId;
            cdl.LinkedEntityId = testCase.Id;
            cdl.ShareType = 'V';
            cdl.Visibility = 'AllUsers';
            cdLinks.add(cdl);
        }
        insert cdLinks;
        
        List<CaseAttachmentController.FileInfo> files = CaseAttachmentController.getCaseAttachments(testCase.Id);
        System.assertEquals(1, files.size());
    }

}